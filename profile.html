<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Profile - Digital Reads</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand" href="index.html">üìö Digital Reads</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link" href="index.html">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="about.html">About us</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="books.html">Books</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="readDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Read
          </a>
          <ul class="dropdown-menu" aria-labelledby="readDropdown">
            <li><a class="dropdown-item" href="my_books.html">My Books</a></li>
            <li><a class="dropdown-item" href="talk.html">Talk</a></li>
            <li><a class="dropdown-item" href="news.html">News</a></li>
            <li><a class="dropdown-item" href="blog.html">Blog</a></li>
          </ul>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="events.html">Events</a>
        </li>
        <li class="nav-item" id="authItem">
          <a class="nav-link active" href="profile.html">Profile</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="langDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            üåê ENG
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="langDropdown">
            <li><a class="dropdown-item lang-select" data-lang="KAZ" href="#">KAZ</a></li>
            <li><a class="dropdown-item lang-select" data-lang="RUS" href="#">RUS</a></li>
            <li><a class="dropdown-item lang-select" data-lang="ENG" href="#">ENG</a></li>
          </ul>
        </li>
        <li class="nav-item d-flex align-items-center">
          <button id="toggleDarkModeBtn"
                  class="btn btn-outline-secondary ms-2"
                  type="button"
                  aria-label="Toggle dark mode"
                  style="min-width:44px; border-radius:50%; font-size:1.4rem; padding:6px 10px; line-height:1;">
            üåô
          </button>
        </li>
      </ul>
    </div>
  </div>
</nav>

  <div id="scrollProgress"></div>

  <div class="container my-5">
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6">
        <div class="card" style="animation: none; opacity: 1; transform: none;">
          <div class="card-body p-5">
            <!-- Tabs for Login/Register -->
            <ul class="nav nav-pills nav-justified mb-4" id="authTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button" role="tab">
                  Sign In
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register" type="button" role="tab">
                  Create Account
                </button>
              </li>
            </ul>

            <div class="tab-content" id="authTabsContent">
              
              <!-- Login Form -->
              <div class="tab-pane fade show active" id="login" role="tabpanel">
                <h2 class="text-center mb-4">Welcome Back</h2>
                
                <form id="loginForm" novalidate>
                  <div class="mb-4">
                    <label for="loginEmail" class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="loginEmail" placeholder="you@example.com" required />
                    <div class="invalid-feedback">Please enter a valid email address.</div>
                  </div>

                  <div class="mb-4">
                    <label for="loginPassword" class="form-label">Password</label>
                    <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password" required />
                    <div class="invalid-feedback">Please enter your password.</div>
                  </div>

                  <div class="form-check mb-4">
                    <input class="form-check-input" type="checkbox" id="rememberMe" />
                    <label class="form-check-label" for="rememberMe">Remember me</label>
                  </div>

                  <button type="submit" class="btn btn-primary w-100">
                    <span id="loginText">Sign In</span>
                    <span id="loginSpinner" class="spinner-border spinner-border-sm d-none ms-2"></span>
                  </button>
                </form>

                <div id="loginSuccess" class="alert alert-success mt-4 d-none" role="alert">
                  ‚úÖ Login successful! Redirecting...
                </div>
                <div id="loginError" class="alert alert-danger mt-4 d-none" role="alert">
                  ‚ùå Invalid email or password. Please check your credentials or create a new account.
                </div>
              </div>

              <!-- Registration Form -->
              <div class="tab-pane fade" id="register" role="tabpanel">
                <h2 class="text-center mb-4">Create Your Profile</h2>
                
                <form id="registrationForm" novalidate>
                  <div class="mb-4">
                    <label for="fullName" class="form-label">Full Name</label>
                    <input type="text" class="form-control" id="fullName" placeholder="John Doe" required />
                    <div class="invalid-feedback">Please enter your full name.</div>
                  </div>

                  <div class="mb-4">
                    <label for="email" class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="email" placeholder="you@example.com" required />
                    <div class="invalid-feedback">Please enter a valid email address.</div>
                  </div>

                  <div class="mb-4">
                    <label for="phone" class="form-label">Phone Number</label>
                    <input type="tel" class="form-control" id="phone" placeholder="+7 (777) 123-4567" pattern="[\+\d\s\(\)\-]{10,}" required />
                    <div class="invalid-feedback">Please enter a valid phone number.</div>
                  </div>

                  <div class="mb-4">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="password" placeholder="Minimum 8 characters with letters and numbers" required minlength="8" />
                    <div class="invalid-feedback">Password must be at least 8 characters and contain letters and numbers.</div>
                    <div class="form-text">
                      Password must contain:
                      <ul class="small mb-0">
                        <li id="lengthCheck">At least 8 characters</li>
                        <li id="letterCheck">At least one letter</li>
                        <li id="numberCheck">At least one number</li>
                      </ul>
                    </div>
                  </div>

                  <div class="mb-4">
                    <label for="confirmPassword" class="form-label">Confirm Password</label>
                    <input type="password" class="form-control" id="confirmPassword" placeholder="Re-enter password" required />
                    <div class="invalid-feedback">Passwords must match.</div>
                  </div>

                  <button type="submit" class="btn btn-primary w-100">
                    <span id="registerText">Create Account</span>
                    <span id="registerSpinner" class="spinner-border spinner-border-sm d-none ms-2"></span>
                  </button>
                </form>

                <div id="registrationSuccess" class="alert alert-success mt-4 d-none" role="alert">
                  ‚úÖ Registration successful! Welcome to Digital Reads!
                </div>
              </div>
            </div>

            <!-- User Profile (shown when logged in) -->
            <div id="userProfile" class="d-none">
              <div class="text-center mb-4">
                <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
                     style="width: 80px; height: 80px; font-size: 2rem;">
                  üë§
                </div>
                <h2 id="userGreeting">Welcome, User!</h2>
                <p class="text-muted" id="userEmail">user@example.com</p>
              </div>

              <div class="card mb-4">
                <div class="card-body">
                  <h5 class="card-title">Profile Information</h5>
                  <div class="row">
                    <div class="col-6">
                      <strong>Name:</strong>
                      <p id="profileName">John Doe</p>
                    </div>
                    <div class="col-6">
                      <strong>Phone:</strong>
                      <p id="profilePhone">+7 (777) 123-4567</p>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-12">
                      <strong>Member since:</strong>
                      <p id="memberSince">January 2025</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="d-grid gap-2">         
                <button id="logoutBtn" class="btn btn-outline-danger">Log Out</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <p>&copy; 2025 Digital Reads | Team: Nurassyl, Dias, Nurkhan, Bekbolat</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="js/script.js"></script>
  
  <!-- Add this script directly to profile.html to ensure auth works -->
  <script>
  // Simple auth system for profile page
  class ProfileAuth {
    constructor() {
      this.init();
    }

    init() {
      this.checkAuthState();
      this.setupEventListeners();
    }

    checkAuthState() {
      const currentUser = this.getFromStorage('digitalReadsUser');
      if (currentUser) {
        this.showUserProfile(currentUser);
      } else {
        this.showAuthForms();
      }
    }

    showUserProfile(user) {
      const authTabs = document.getElementById('authTabs');
      const authTabsContent = document.getElementById('authTabsContent');
      const userProfile = document.getElementById('userProfile');
      
      if (authTabs) authTabs.classList.add('d-none');
      if (authTabsContent) authTabsContent.classList.add('d-none');
      if (userProfile) userProfile.classList.remove('d-none');
      
      // Update profile information
      document.getElementById('userGreeting').textContent = `Welcome, ${user.fullName}!`;
      document.getElementById('userEmail').textContent = user.email;
      document.getElementById('profileName').textContent = user.fullName;
      document.getElementById('profilePhone').textContent = user.phone || 'Not provided';
      document.getElementById('memberSince').textContent = new Date(user.joinDate).toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'long',
        day: 'numeric'
      });
    }

    showAuthForms() {
      const authTabs = document.getElementById('authTabs');
      const authTabsContent = document.getElementById('authTabsContent');
      const userProfile = document.getElementById('userProfile');
      
      if (authTabs) authTabs.classList.remove('d-none');
      if (authTabsContent) authTabsContent.classList.remove('d-none');
      if (userProfile) userProfile.classList.add('d-none');
    }

    setupEventListeners() {
      // Login form
      const loginForm = document.getElementById('loginForm');
      if (loginForm) {
        loginForm.addEventListener('submit', (e) => this.handleLogin(e));
      }
      
      // Registration form
      const registerForm = document.getElementById('registrationForm');
      if (registerForm) {
        registerForm.addEventListener('submit', (e) => this.handleRegistration(e));
        // Password validation
        const passwordInput = document.getElementById('password');
        if (passwordInput) {
          passwordInput.addEventListener('input', (e) => this.validatePassword(e.target.value));
        }
      }
      
      // Logout button
      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', () => this.handleLogout());
      }
      
      // Edit profile button
      const editProfileBtn = document.getElementById('editProfileBtn');
      if (editProfileBtn) {
        editProfileBtn.addEventListener('click', () => this.handleEditProfile());
      }
    }

    handleLogin(e) {
      e.preventDefault();
      
      const email = document.getElementById('loginEmail')?.value.trim() || '';
      const password = document.getElementById('loginPassword')?.value || '';
      
      // Clear previous validation and errors
      document.querySelectorAll('#loginForm .is-invalid').forEach(el => {
        el.classList.remove('is-invalid');
      });
      document.getElementById('loginError')?.classList.add('d-none');
      
      let isValid = true;
      
      // Basic validation
      if (!email) {
        document.getElementById('loginEmail')?.classList.add('is-invalid');
        isValid = false;
      }
      
      if (!password) {
        document.getElementById('loginPassword')?.classList.add('is-invalid');
        isValid = false;
      }
      
      if (!isValid) {
        this.showToast('‚ùå Please fill in all fields');
        return;
      }
      
      // Show loading state
      this.toggleLoginLoading(true);
      
      // Simulate API call
      setTimeout(() => {
        const users = this.getFromStorage('digitalReadsUsers') || [];
        const user = users.find(u => u.email === email && u.password === password);
        
        this.toggleLoginLoading(false);
        
        if (user) {
          // Successful login
          const userData = {
            fullName: user.fullName,
            email: user.email,
            phone: user.phone,
            joinDate: user.joinDate || new Date().toISOString()
          };
          
          this.saveToStorage('digitalReadsUser', userData);
          this.showUserProfile(userData);
          
          const successMsg = document.getElementById('loginSuccess');
          if (successMsg) successMsg.classList.remove('d-none');
          
          this.showToast('‚úÖ Login successful!');
          
          // Redirect after delay
          setTimeout(() => {
            window.location.href = 'index.html';
          }, 1500);
        } else {
          // Failed login
          const errorMsg = document.getElementById('loginError');
          if (errorMsg) errorMsg.classList.remove('d-none');
          this.showToast('‚ùå Invalid email or password');
        }
      }, 1000);
    }

    handleRegistration(e) {
      e.preventDefault();
      
      const fullName = document.getElementById('fullName')?.value.trim() || '';
      const email = document.getElementById('email')?.value.trim() || '';
      const phone = document.getElementById('phone')?.value.trim() || '';
      const password = document.getElementById('password')?.value || '';
      const confirmPassword = document.getElementById('confirmPassword')?.value || '';
      
      // Clear previous validation
      document.querySelectorAll('#registrationForm .is-invalid').forEach(el => {
        el.classList.remove('is-invalid');
      });
      
      let isValid = true;
      
      // Full name validation
      if (fullName.length < 2) {
        document.getElementById('fullName')?.classList.add('is-invalid');
        isValid = false;
      }
      
      // Email validation
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        document.getElementById('email')?.classList.add('is-invalid');
        isValid = false;
      }
      
      // Phone validation (basic)
      if (!phone || phone.length < 10) {
        document.getElementById('phone')?.classList.add('is-invalid');
        isValid = false;
      }
      
      // Password validation
      if (!this.validatePassword(password)) {
        document.getElementById('password')?.classList.add('is-invalid');
        isValid = false;
      }
      
      // Confirm password
      if (password !== confirmPassword) {
        document.getElementById('confirmPassword')?.classList.add('is-invalid');
        isValid = false;
      }
      
      if (!isValid) {
        this.showToast('‚ùå Please fix the errors in the form');
        return;
      }
      
      // Check if user already exists
      const users = this.getFromStorage('digitalReadsUsers') || [];
      if (users.some(u => u.email === email)) {
        document.getElementById('email')?.classList.add('is-invalid');
        this.showToast('‚ùå User with this email already exists');
        return;
      }
      
      // Show loading state
      this.toggleRegisterLoading(true);
      
      // Simulate registration
      setTimeout(() => {
        const newUser = {
          fullName,
          email,
          phone,
          password,
          joinDate: new Date().toISOString()
        };
        
        users.push(newUser);
        this.saveToStorage('digitalReadsUsers', users);
        
        // Auto-login after registration
        const userData = {
          fullName,
          email,
          phone,
          joinDate: newUser.joinDate
        };
        this.saveToStorage('digitalReadsUser', userData);
        
        this.toggleRegisterLoading(false);
        
        const successMsg = document.getElementById('registrationSuccess');
        if (successMsg) successMsg.classList.remove('d-none');
        
        this.showToast('‚úÖ Registration successful!');
        
        // Show user profile and redirect
        setTimeout(() => {
          this.showUserProfile(userData);
          setTimeout(() => {
            window.location.href = 'index.html';
          }, 1000);
        }, 1500);
      }, 1500);
    }

    validatePassword(password) {
      const hasMinLength = password.length >= 8;
      const hasLetter = /[a-zA-Z]/.test(password);
      const hasNumber = /\d/.test(password);
      
      // Update validation UI
      const lengthCheck = document.getElementById('lengthCheck');
      const letterCheck = document.getElementById('letterCheck');
      const numberCheck = document.getElementById('numberCheck');
      
      if (lengthCheck) lengthCheck.style.color = hasMinLength ? 'var(--success, #28a745)' : 'inherit';
      if (letterCheck) letterCheck.style.color = hasLetter ? 'var(--success, #28a745)' : 'inherit';
      if (numberCheck) numberCheck.style.color = hasNumber ? 'var(--success, #28a745)' : 'inherit';
      
      return hasMinLength && hasLetter && hasNumber;
    }

    toggleLoginLoading(isLoading) {
      const loginText = document.getElementById('loginText');
      const loginSpinner = document.getElementById('loginSpinner');
      
      if (isLoading) {
        loginText?.classList.add('d-none');
        loginSpinner?.classList.remove('d-none');
      } else {
        loginText?.classList.remove('d-none');
        loginSpinner?.classList.add('d-none');
      }
    }

    toggleRegisterLoading(isLoading) {
      const registerText = document.getElementById('registerText');
      const registerSpinner = document.getElementById('registerSpinner');
      
      if (isLoading) {
        registerText?.classList.add('d-none');
        registerSpinner?.classList.remove('d-none');
      } else {
        registerText?.classList.remove('d-none');
        registerSpinner?.classList.add('d-none');
      }
    }

    handleLogout() {
      localStorage.removeItem('digitalReadsUser');
      this.showAuthForms();
      this.showToast('üëã Logged out successfully.');
      
      // Clear forms
      document.getElementById('loginForm')?.reset();
      document.getElementById('registrationForm')?.reset();
    }

    
    // Storage helpers
    saveToStorage(key, data) {
      try {
        localStorage.setItem(key, JSON.stringify(data));
        return true;
      } catch (e) {
        console.error('Storage error:', e);
        return false;
      }
    }

    getFromStorage(key) {
      try {
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : null;
      } catch (e) {
        console.error('Storage error:', e);
        return null;
      }
    }

    showToast(message) {
      // Use the global showToast function if available, otherwise create a simple one
      if (window.showToast) {
        window.showToast(message);
      } else {
        // Simple fallback
        console.log('Toast:', message);
        alert(message);
      }
    }
  }

  // Initialize when page loads
  document.addEventListener('DOMContentLoaded', function() {
    new ProfileAuth();
  });
  </script>
</body>
</html>
